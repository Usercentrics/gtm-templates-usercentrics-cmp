___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Usercentrics CMP",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Integrate our CMP Script Tag to easily control scripts implemented on your website and manage consent settings of your users.\n\nMore info at www.usercentrics.com",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "data-settings-id",
    "displayName": "Settings Id",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Your settings Id"
  },
  {
    "type": "TEXT",
    "name": "data-language",
    "displayName": "Default Language",
    "simpleValueType": true,
    "help": "Sets the default language (if any)",
    "defaultValue": "auto"
  },
  {
    "type": "CHECKBOX",
    "name": "data-tcf-enabled",
    "checkboxText": "Enable Transparency \u0026 Consent Framework 2.0 (TCF)",
    "simpleValueType": true,
    "help": "Sets whether TCF 2.0 is enabled or not"
  },
  {
    "type": "CHECKBOX",
    "name": "data-amp-enabled",
    "checkboxText": "Enable Accelerated Mobile Pages Framework (AMP)",
    "simpleValueType": true,
    "help": "Sets whether AMP is enabled or not"
  },
  {
    "type": "GROUP",
    "name": "defaultConsentPreferences",
    "displayName": "Default Consent State",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "consentAnalytics",
        "displayName": "Statistics (consent type analytics_storage)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "help": "Select default consent state for analytics tags"
      },
      {
        "type": "SELECT",
        "name": "consentAds",
        "displayName": "Ads/Marketing (consent type ad_storage)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "help": "Select default consent state for analytics tags"
      },
      {
        "type": "SELECT",
        "name": "consentStorage",
        "displayName": "Preferences (consent types functionality_storage and personalization_storage)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "help": "Select default consent state for preference tags"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "waitForUpdate",
    "displayName": "Wait for update",
    "simpleValueType": true,
    "help": "Set how many miliseconds to wait before firing tags waiting for consent",
    "valueValidators": [
      {
        "type": "NON_NEGATIVE_NUMBER"
      }
    ],
    "valueUnit": "ms",
    "defaultValue": 2000
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const setInWindow = require('setInWindow');
const setDefaultConsentState = require('setDefaultConsentState');
const makeNumber = require('makeNumber');

const isTcfEnabled = data['data-tcf-enabled'];
const defaultLanguage = data['data-language'];
const settingsId = data['data-settings-id'];
const isAmpEnabled = data['data-amp-enabled'];

setDefaultConsentState({
  'functionality_storage': data.consentStorage,
  'personalization_storage': data.consentStorage,
  'analytics_storage': data.consentAnalytics,
  'ad_storage': data.consentAds,
  'security_storage': 'granted',
  'wait_for_update': makeNumber(data.waitForUpdate)
});

let scriptUrl = 'https://storage.googleapis.com/usercentrics-integration-test-browser-ui/test/EUD-1646/loader.js';

setInWindow('settingsId', settingsId);

if (defaultLanguage !== 'auto' && queryPermission('access_globals', 'language'))
{
  setInWindow('language', defaultLanguage);
}


if (isTcfEnabled && queryPermission('access_globals', 'tcfEnabled'))
{
  setInWindow('tcfEnabled', true);
}

if (isAmpEnabled && queryPermission('access_globals', 'ampEnabled'))
{
  setInWindow('ampEnabled', true);
}


if (queryPermission('inject_script', scriptUrl)) {
  injectScript(scriptUrl, data.gtmOnSuccess, data.gtmOnFailure);
} else {
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://storage.googleapis.com/usercentrics-integration-test-browser-ui/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "settingsId"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "tcfEnabled"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ampEnabled"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "language"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "gtag"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wait_for_update"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Script inject test
  code: |-
    const mockData = {
      // Mocked field values
      'data-settings-id': 'GVl-ixMH'
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the script was injected
    assertApi('injectScript').wasCalled();
- name: Window injection test
  code: |-
    const mockData = {
      // Mocked field values
      'data-settings-id': 'GVl-ixMH'
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('setInWindow').wasCalled();


___NOTES___

Created on 18/11/2021, 18:01:02


